"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.notificationsRelations = exports.paymentsRelations = exports.ownersRelations = exports.sessionsRelations = exports.queuesRelations = exports.stationsRelations = exports.usersRelations = exports.auditLogs = exports.payments = exports.notifications = exports.userSearchHistory = exports.geocodeCacheV2 = exports.admins = exports.stationOwners = exports.chargingSessions = exports.queues = exports.chargingStations = exports.users = void 0;
const pg_core_1 = require("drizzle-orm/pg-core");
const drizzle_orm_1 = require("drizzle-orm");
exports.users = (0, pg_core_1.pgTable)('users', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    whatsappId: (0, pg_core_1.varchar)('whatsapp_id', { length: 20 }).notNull().unique(),
    name: (0, pg_core_1.varchar)('name', { length: 100 }),
    phoneNumber: (0, pg_core_1.varchar)('phone_number', { length: 20 }),
    vehicleType: (0, pg_core_1.varchar)('vehicle_type', { length: 50 }),
    evModel: (0, pg_core_1.varchar)('ev_model', { length: 100 }),
    connectorType: (0, pg_core_1.varchar)('connector_type', { length: 20 }),
    chargingIntent: (0, pg_core_1.varchar)('charging_intent', { length: 50 }),
    queuePreference: (0, pg_core_1.varchar)('queue_preference', { length: 30 }),
    isActive: (0, pg_core_1.boolean)('is_active').default(true),
    isBanned: (0, pg_core_1.boolean)('is_banned').default(false),
    preferencesCaptured: (0, pg_core_1.boolean)('preferences_captured').default(false),
    profilePicture: (0, pg_core_1.text)('profile_picture'),
    language: (0, pg_core_1.varchar)('language', { length: 10 }).default('en'),
    timezone: (0, pg_core_1.varchar)('timezone', { length: 50 }).default('Asia/Kolkata'),
    notificationsEnabled: (0, pg_core_1.boolean)('notifications_enabled').default(true),
    smsNotifications: (0, pg_core_1.boolean)('sms_notifications').default(false),
    emailNotifications: (0, pg_core_1.boolean)('email_notifications').default(false),
    email: (0, pg_core_1.varchar)('email', { length: 150 }),
    totalBookings: (0, pg_core_1.integer)('total_bookings').default(0),
    totalSessions: (0, pg_core_1.integer)('total_sessions').default(0),
    totalEnergyConsumed: (0, pg_core_1.decimal)('total_energy_consumed', { precision: 10, scale: 3 }).default('0'),
    lastActivityAt: (0, pg_core_1.timestamp)('last_activity_at').defaultNow(),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    whatsappIdIdx: (0, pg_core_1.index)('users_whatsapp_id_idx').on(table.whatsappId),
    nameIdx: (0, pg_core_1.index)('users_name_idx').on(table.name),
    activityIdx: (0, pg_core_1.index)('users_activity_idx').on(table.lastActivityAt),
    preferencesIdx: (0, pg_core_1.index)('users_preferences_idx').on(table.preferencesCaptured),
}));
exports.chargingStations = (0, pg_core_1.pgTable)('charging_stations', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    name: (0, pg_core_1.varchar)('name', { length: 200 }).notNull(),
    address: (0, pg_core_1.text)('address').notNull(),
    latitude: (0, pg_core_1.decimal)('latitude', { precision: 10, scale: 8 }).notNull(),
    longitude: (0, pg_core_1.decimal)('longitude', { precision: 11, scale: 8 }).notNull(),
    geohash: (0, pg_core_1.varchar)('geohash', { length: 12 }),
    distance: (0, pg_core_1.decimal)('distance', { precision: 8, scale: 3 }),
    totalPorts: (0, pg_core_1.integer)('total_ports').notNull().default(1),
    availablePorts: (0, pg_core_1.integer)('available_ports').notNull().default(1),
    totalSlots: (0, pg_core_1.integer)('total_slots').notNull().default(1),
    availableSlots: (0, pg_core_1.integer)('available_slots').notNull().default(1),
    connectorTypes: (0, pg_core_1.jsonb)('connector_types').notNull(),
    maxPowerKw: (0, pg_core_1.integer)('max_power_kw').notNull().default(50),
    pricePerKwh: (0, pg_core_1.decimal)('price_per_kwh', { precision: 5, scale: 2 }).notNull().default('10.00'),
    pricePerUnit: (0, pg_core_1.decimal)('price_per_unit', { precision: 5, scale: 2 }).notNull().default('10.00'),
    isActive: (0, pg_core_1.boolean)('is_active').default(true),
    isOpen: (0, pg_core_1.boolean)('is_open').default(true),
    isPaused: (0, pg_core_1.boolean)('is_paused').default(false),
    maintenanceMode: (0, pg_core_1.boolean)('maintenance_mode').default(false),
    currentQueueLength: (0, pg_core_1.integer)('current_queue_length').default(0),
    maxQueueLength: (0, pg_core_1.integer)('max_queue_length').default(10),
    averageSessionMinutes: (0, pg_core_1.integer)('average_session_minutes').default(30),
    operatingHours: (0, pg_core_1.jsonb)('operating_hours').default('{"monday": "24/7", "tuesday": "24/7", "wednesday": "24/7", "thursday": "24/7", "friday": "24/7", "saturday": "24/7", "sunday": "24/7"}'),
    amenities: (0, pg_core_1.jsonb)('amenities').default('[]'),
    description: (0, pg_core_1.text)('description'),
    ownerWhatsappId: (0, pg_core_1.varchar)('owner_whatsapp_id', { length: 20 }).notNull(),
    contactNumber: (0, pg_core_1.varchar)('contact_number', { length: 20 }),
    emergencyContact: (0, pg_core_1.varchar)('emergency_contact', { length: 20 }),
    totalSessions: (0, pg_core_1.integer)('total_sessions').default(0),
    totalEnergyDelivered: (0, pg_core_1.decimal)('total_energy_delivered', { precision: 12, scale: 3 }).default('0'),
    totalRevenue: (0, pg_core_1.decimal)('total_revenue', { precision: 12, scale: 2 }).default('0'),
    averageRating: (0, pg_core_1.decimal)('average_rating', { precision: 3, scale: 2 }).default('0'),
    rating: (0, pg_core_1.decimal)('rating', { precision: 3, scale: 2 }).default('0'),
    reviewCount: (0, pg_core_1.integer)('review_count').default(0),
    totalReviews: (0, pg_core_1.integer)('total_reviews').default(0),
    lastMaintenanceAt: (0, pg_core_1.timestamp)('last_maintenance_at'),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    locationIdx: (0, pg_core_1.index)('stations_location_idx').on(table.latitude, table.longitude),
    geohashIdx: (0, pg_core_1.index)('stations_geohash_idx').on(table.geohash),
    ownerIdx: (0, pg_core_1.index)('stations_owner_idx').on(table.ownerWhatsappId),
    activeIdx: (0, pg_core_1.index)('stations_active_idx').on(table.isActive, table.isOpen),
    availabilityIdx: (0, pg_core_1.index)('stations_availability_idx').on(table.availablePorts, table.currentQueueLength),
    priceIdx: (0, pg_core_1.index)('stations_price_idx').on(table.pricePerKwh),
    ratingIdx: (0, pg_core_1.index)('stations_rating_idx').on(table.averageRating),
}));
exports.queues = (0, pg_core_1.pgTable)('queues', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    stationId: (0, pg_core_1.integer)('station_id').notNull().references(() => exports.chargingStations.id),
    userWhatsapp: (0, pg_core_1.varchar)('user_whatsapp', { length: 20 }).notNull().references(() => exports.users.whatsappId),
    position: (0, pg_core_1.integer)('position').notNull(),
    status: (0, pg_core_1.varchar)('status', { length: 20 }).notNull().default('waiting'),
    estimatedWaitMinutes: (0, pg_core_1.integer)('estimated_wait_minutes'),
    actualWaitMinutes: (0, pg_core_1.integer)('actual_wait_minutes'),
    reservationExpiry: (0, pg_core_1.timestamp)('reservation_expiry'),
    reservation_expiry: (0, pg_core_1.timestamp)('reservation_expiry_alt'),
    reminderSent: (0, pg_core_1.boolean)('reminder_sent').default(false),
    notificationsSent: (0, pg_core_1.integer)('notifications_sent').default(0),
    requestedConnectorType: (0, pg_core_1.varchar)('requested_connector_type', { length: 20 }),
    requestedMaxPower: (0, pg_core_1.integer)('requested_max_power'),
    estimatedSessionMinutes: (0, pg_core_1.integer)('estimated_session_minutes'),
    ratePerKwhAtBooking: (0, pg_core_1.decimal)('rate_per_kwh_at_booking', { precision: 5, scale: 2 }),
    estimatedCost: (0, pg_core_1.decimal)('estimated_cost', { precision: 8, scale: 2 }),
    joinedAt: (0, pg_core_1.timestamp)('joined_at').defaultNow(),
    readyAt: (0, pg_core_1.timestamp)('ready_at'),
    expiredAt: (0, pg_core_1.timestamp)('expired_at'),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    stationPositionIdx: (0, pg_core_1.index)('queues_station_position_idx').on(table.stationId, table.position),
    statusIdx: (0, pg_core_1.index)('queues_status_idx').on(table.status),
    expiryIdx: (0, pg_core_1.index)('queues_expiry_idx').on(table.reservationExpiry),
    userActiveIdx: (0, pg_core_1.index)('queues_user_active_idx').on(table.userWhatsapp, table.status),
    waitTimeIdx: (0, pg_core_1.index)('queues_wait_time_idx').on(table.estimatedWaitMinutes),
    userStationUnique: (0, pg_core_1.unique)('queues_user_station_active').on(table.userWhatsapp, table.stationId),
}));
exports.chargingSessions = (0, pg_core_1.pgTable)('charging_sessions', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    sessionId: (0, pg_core_1.varchar)('session_id', { length: 50 }).notNull().unique(),
    stationId: (0, pg_core_1.integer)('station_id').notNull().references(() => exports.chargingStations.id),
    userWhatsapp: (0, pg_core_1.varchar)('user_whatsapp', { length: 20 }).notNull().references(() => exports.users.whatsappId),
    queueId: (0, pg_core_1.integer)('queue_id').references(() => exports.queues.id),
    status: (0, pg_core_1.varchar)('status', { length: 20 }).notNull().default('initiated'),
    startTime: (0, pg_core_1.timestamp)('start_time'),
    endTime: (0, pg_core_1.timestamp)('end_time'),
    startedAt: (0, pg_core_1.timestamp)('started_at'),
    endedAt: (0, pg_core_1.timestamp)('ended_at'),
    duration: (0, pg_core_1.integer)('duration'),
    connectorUsed: (0, pg_core_1.varchar)('connector_used', { length: 20 }),
    maxPowerUsed: (0, pg_core_1.integer)('max_power_used'),
    energyDelivered: (0, pg_core_1.decimal)('energy_delivered', { precision: 8, scale: 3 }),
    energyConsumed: (0, pg_core_1.decimal)('energy_consumed', { precision: 8, scale: 3 }),
    peakPowerKw: (0, pg_core_1.decimal)('peak_power_kw', { precision: 6, scale: 2 }),
    averagePowerKw: (0, pg_core_1.decimal)('average_power_kw', { precision: 6, scale: 2 }),
    totalCost: (0, pg_core_1.decimal)('total_cost', { precision: 10, scale: 2 }),
    ratePerKwh: (0, pg_core_1.decimal)('rate_per_kwh', { precision: 5, scale: 2 }),
    baseCharge: (0, pg_core_1.decimal)('base_charge', { precision: 6, scale: 2 }).default('0'),
    taxAmount: (0, pg_core_1.decimal)('tax_amount', { precision: 6, scale: 2 }).default('0'),
    discountAmount: (0, pg_core_1.decimal)('discount_amount', { precision: 6, scale: 2 }).default('0'),
    paymentStatus: (0, pg_core_1.varchar)('payment_status', { length: 20 }).default('pending'),
    paymentMethod: (0, pg_core_1.varchar)('payment_method', { length: 30 }),
    transactionId: (0, pg_core_1.varchar)('transaction_id', { length: 100 }),
    vehicleModel: (0, pg_core_1.varchar)('vehicle_model', { length: 100 }),
    initialBatteryPercent: (0, pg_core_1.integer)('initial_battery_percent'),
    finalBatteryPercent: (0, pg_core_1.integer)('final_battery_percent'),
    stopReason: (0, pg_core_1.varchar)('stop_reason', { length: 50 }),
    hadIssues: (0, pg_core_1.boolean)('had_issues').default(false),
    issueDescription: (0, pg_core_1.text)('issue_description'),
    customerRating: (0, pg_core_1.integer)('customer_rating'),
    customerFeedback: (0, pg_core_1.text)('customer_feedback'),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    userIdx: (0, pg_core_1.index)('sessions_user_idx').on(table.userWhatsapp),
    stationIdx: (0, pg_core_1.index)('sessions_station_idx').on(table.stationId),
    statusIdx: (0, pg_core_1.index)('sessions_status_idx').on(table.status),
    dateIdx: (0, pg_core_1.index)('sessions_date_idx').on(table.createdAt),
    paymentIdx: (0, pg_core_1.index)('sessions_payment_idx').on(table.paymentStatus),
    ratingIdx: (0, pg_core_1.index)('sessions_rating_idx').on(table.customerRating),
    startedAtIdx: (0, pg_core_1.index)('sessions_started_at_idx').on(table.startedAt),
    endedAtIdx: (0, pg_core_1.index)('sessions_ended_at_idx').on(table.endedAt),
}));
exports.stationOwners = (0, pg_core_1.pgTable)('station_owners', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    whatsappId: (0, pg_core_1.varchar)('whatsapp_id', { length: 20 }).notNull().unique(),
    name: (0, pg_core_1.varchar)('name', { length: 100 }).notNull(),
    phoneNumber: (0, pg_core_1.varchar)('phone_number', { length: 20 }),
    email: (0, pg_core_1.varchar)('email', { length: 150 }),
    businessName: (0, pg_core_1.varchar)('business_name', { length: 200 }),
    businessType: (0, pg_core_1.varchar)('business_type', { length: 50 }),
    businessRegistrationNumber: (0, pg_core_1.varchar)('business_registration_number', { length: 50 }),
    gstNumber: (0, pg_core_1.varchar)('gst_number', { length: 20 }),
    address: (0, pg_core_1.text)('address'),
    city: (0, pg_core_1.varchar)('city', { length: 100 }),
    state: (0, pg_core_1.varchar)('state', { length: 100 }),
    pincode: (0, pg_core_1.varchar)('pincode', { length: 10 }),
    isVerified: (0, pg_core_1.boolean)('is_verified').default(false),
    kycStatus: (0, pg_core_1.varchar)('kyc_status', { length: 20 }).default('pending'),
    verificationDocuments: (0, pg_core_1.jsonb)('verification_documents'),
    verifiedAt: (0, pg_core_1.timestamp)('verified_at'),
    verifiedBy: (0, pg_core_1.varchar)('verified_by', { length: 20 }),
    bankAccountNumber: (0, pg_core_1.varchar)('bank_account_number', { length: 30 }),
    ifscCode: (0, pg_core_1.varchar)('ifsc_code', { length: 15 }),
    accountHolderName: (0, pg_core_1.varchar)('account_holder_name', { length: 100 }),
    totalStations: (0, pg_core_1.integer)('total_stations').default(0),
    totalRevenue: (0, pg_core_1.decimal)('total_revenue', { precision: 12, scale: 2 }).default('0'),
    averageRating: (0, pg_core_1.decimal)('average_rating', { precision: 3, scale: 2 }).default('0'),
    isActive: (0, pg_core_1.boolean)('is_active').default(true),
    permissions: (0, pg_core_1.jsonb)('permissions').notNull().default('["manage_own_stations"]'),
    subscriptionPlan: (0, pg_core_1.varchar)('subscription_plan', { length: 30 }).default('basic'),
    subscriptionExpiry: (0, pg_core_1.timestamp)('subscription_expiry'),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    whatsappIdIdx: (0, pg_core_1.index)('owners_whatsapp_id_idx').on(table.whatsappId),
    verificationIdx: (0, pg_core_1.index)('owners_verification_idx').on(table.isVerified, table.kycStatus),
    businessIdx: (0, pg_core_1.index)('owners_business_idx').on(table.businessName),
    locationIdx: (0, pg_core_1.index)('owners_location_idx').on(table.city, table.state),
}));
exports.admins = (0, pg_core_1.pgTable)('admins', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    whatsappId: (0, pg_core_1.varchar)('whatsapp_id', { length: 20 }).notNull().unique(),
    name: (0, pg_core_1.varchar)('name', { length: 100 }).notNull(),
    email: (0, pg_core_1.varchar)('email', { length: 150 }),
    role: (0, pg_core_1.varchar)('role', { length: 30 }).notNull().default('admin'),
    permissions: (0, pg_core_1.jsonb)('permissions').notNull().default('["manage_owners", "manage_users", "view_analytics"]'),
    isActive: (0, pg_core_1.boolean)('is_active').default(true),
    canAccessFinance: (0, pg_core_1.boolean)('can_access_finance').default(false),
    canModifyStations: (0, pg_core_1.boolean)('can_modify_stations').default(false),
    canBanUsers: (0, pg_core_1.boolean)('can_ban_users').default(false),
    lastLoginAt: (0, pg_core_1.timestamp)('last_login_at'),
    loginCount: (0, pg_core_1.integer)('login_count').default(0),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    whatsappIdIdx: (0, pg_core_1.index)('admins_whatsapp_id_idx').on(table.whatsappId),
    roleIdx: (0, pg_core_1.index)('admins_role_idx').on(table.role),
    activeIdx: (0, pg_core_1.index)('admins_active_idx').on(table.isActive),
}));
exports.geocodeCacheV2 = (0, pg_core_1.pgTable)('geocode_cache_v2', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    searchTerm: (0, pg_core_1.text)('search_term').notNull().unique(),
    originalAddress: (0, pg_core_1.text)('original_address').notNull(),
    latitude: (0, pg_core_1.decimal)('latitude', { precision: 10, scale: 8 }).notNull(),
    longitude: (0, pg_core_1.decimal)('longitude', { precision: 11, scale: 8 }).notNull(),
    geohash: (0, pg_core_1.text)('geohash').notNull(),
    formattedAddress: (0, pg_core_1.text)('formatted_address'),
    locality: (0, pg_core_1.text)('locality'),
    subLocality: (0, pg_core_1.text)('sub_locality'),
    state: (0, pg_core_1.text)('state'),
    country: (0, pg_core_1.text)('country').default('India'),
    postalCode: (0, pg_core_1.text)('postal_code'),
    confidence: (0, pg_core_1.decimal)('confidence', { precision: 3, scale: 2 }).default('1.0'),
    source: (0, pg_core_1.varchar)('source', { length: 30 }).default('google'),
    hitCount: (0, pg_core_1.integer)('hit_count').default(1),
    lastUsed: (0, pg_core_1.timestamp)('last_used').defaultNow(),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
}, (table) => ({
    searchTermIdx: (0, pg_core_1.index)('geocode_v2_search_term_idx').on(table.searchTerm),
    geohashIdx: (0, pg_core_1.index)('geocode_v2_geohash_idx').on(table.geohash),
    localityIdx: (0, pg_core_1.index)('geocode_v2_locality_idx').on(table.locality),
    locationIdx: (0, pg_core_1.index)('geocode_v2_location_idx').on(table.latitude, table.longitude),
}));
exports.userSearchHistory = (0, pg_core_1.pgTable)('user_search_history', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    userWhatsapp: (0, pg_core_1.varchar)('user_whatsapp', { length: 20 }).notNull().references(() => exports.users.whatsappId),
    searchTerm: (0, pg_core_1.text)('search_term').notNull(),
    searchType: (0, pg_core_1.varchar)('search_type', { length: 20 }).default('address'),
    latitude: (0, pg_core_1.decimal)('latitude', { precision: 10, scale: 8 }).notNull(),
    longitude: (0, pg_core_1.decimal)('longitude', { precision: 11, scale: 8 }).notNull(),
    resultCount: (0, pg_core_1.integer)('result_count').default(0),
    selectedStationId: (0, pg_core_1.integer)('selected_station_id'),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
}, (table) => ({
    userIdx: (0, pg_core_1.index)('search_history_user_idx').on(table.userWhatsapp),
    termIdx: (0, pg_core_1.index)('search_history_term_idx').on(table.searchTerm),
    dateIdx: (0, pg_core_1.index)('search_history_date_idx').on(table.createdAt),
    typeIdx: (0, pg_core_1.index)('search_history_type_idx').on(table.searchType),
}));
exports.notifications = (0, pg_core_1.pgTable)('notifications', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    userId: (0, pg_core_1.varchar)('user_id', { length: 20 }).notNull().references(() => exports.users.whatsappId),
    type: (0, pg_core_1.varchar)('type', { length: 30 }).notNull(),
    title: (0, pg_core_1.varchar)('title', { length: 200 }).notNull(),
    message: (0, pg_core_1.text)('message').notNull(),
    status: (0, pg_core_1.varchar)('status', { length: 20 }).default('pending'),
    channel: (0, pg_core_1.varchar)('channel', { length: 20 }).default('whatsapp'),
    deliveredAt: (0, pg_core_1.timestamp)('delivered_at'),
    readAt: (0, pg_core_1.timestamp)('read_at'),
    relatedId: (0, pg_core_1.varchar)('related_id', { length: 50 }),
    relatedType: (0, pg_core_1.varchar)('related_type', { length: 30 }),
    metadata: (0, pg_core_1.jsonb)('metadata'),
    scheduledFor: (0, pg_core_1.timestamp)('scheduled_for').defaultNow(),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
}, (table) => ({
    userIdx: (0, pg_core_1.index)('notifications_user_idx').on(table.userId),
    statusIdx: (0, pg_core_1.index)('notifications_status_idx').on(table.status),
    typeIdx: (0, pg_core_1.index)('notifications_type_idx').on(table.type),
    scheduleIdx: (0, pg_core_1.index)('notifications_schedule_idx').on(table.scheduledFor),
}));
exports.payments = (0, pg_core_1.pgTable)('payments', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    paymentId: (0, pg_core_1.varchar)('payment_id', { length: 100 }).notNull().unique(),
    sessionId: (0, pg_core_1.varchar)('session_id', { length: 50 }).notNull().references(() => exports.chargingSessions.sessionId),
    userWhatsapp: (0, pg_core_1.varchar)('user_whatsapp', { length: 20 }).notNull().references(() => exports.users.whatsappId),
    stationId: (0, pg_core_1.integer)('station_id').notNull().references(() => exports.chargingStations.id),
    amount: (0, pg_core_1.decimal)('amount', { precision: 10, scale: 2 }).notNull(),
    currency: (0, pg_core_1.varchar)('currency', { length: 10 }).default('INR'),
    status: (0, pg_core_1.varchar)('status', { length: 20 }).default('pending'),
    method: (0, pg_core_1.varchar)('method', { length: 30 }),
    gatewayTransactionId: (0, pg_core_1.varchar)('gateway_transaction_id', { length: 100 }),
    gatewayResponse: (0, pg_core_1.jsonb)('gateway_response'),
    refundAmount: (0, pg_core_1.decimal)('refund_amount', { precision: 10, scale: 2 }).default('0'),
    refundReason: (0, pg_core_1.text)('refund_reason'),
    refundedAt: (0, pg_core_1.timestamp)('refunded_at'),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
    updatedAt: (0, pg_core_1.timestamp)('updated_at').defaultNow(),
}, (table) => ({
    userIdx: (0, pg_core_1.index)('payments_user_idx').on(table.userWhatsapp),
    stationIdx: (0, pg_core_1.index)('payments_station_idx').on(table.stationId),
    statusIdx: (0, pg_core_1.index)('payments_status_idx').on(table.status),
    dateIdx: (0, pg_core_1.index)('payments_date_idx').on(table.createdAt),
}));
exports.auditLogs = (0, pg_core_1.pgTable)('audit_logs', {
    id: (0, pg_core_1.serial)('id').primaryKey(),
    actorWhatsappId: (0, pg_core_1.varchar)('actor_whatsapp_id', { length: 20 }).notNull(),
    actorType: (0, pg_core_1.varchar)('actor_type', { length: 20 }).notNull(),
    action: (0, pg_core_1.varchar)('action', { length: 100 }).notNull(),
    resourceType: (0, pg_core_1.varchar)('resource_type', { length: 50 }),
    resourceId: (0, pg_core_1.varchar)('resource_id', { length: 50 }),
    oldValues: (0, pg_core_1.jsonb)('old_values'),
    newValues: (0, pg_core_1.jsonb)('new_values'),
    metadata: (0, pg_core_1.jsonb)('metadata'),
    ipAddress: (0, pg_core_1.varchar)('ip_address', { length: 45 }),
    userAgent: (0, pg_core_1.text)('user_agent'),
    endpoint: (0, pg_core_1.varchar)('endpoint', { length: 200 }),
    createdAt: (0, pg_core_1.timestamp)('created_at').defaultNow(),
}, (table) => ({
    actorIdx: (0, pg_core_1.index)('audit_actor_idx').on(table.actorWhatsappId),
    actionIdx: (0, pg_core_1.index)('audit_action_idx').on(table.action),
    dateIdx: (0, pg_core_1.index)('audit_date_idx').on(table.createdAt),
    resourceIdx: (0, pg_core_1.index)('audit_resource_idx').on(table.resourceType, table.resourceId),
}));
exports.usersRelations = (0, drizzle_orm_1.relations)(exports.users, ({ many }) => ({
    queues: many(exports.queues),
    sessions: many(exports.chargingSessions),
    searchHistory: many(exports.userSearchHistory),
    notifications: many(exports.notifications),
    payments: many(exports.payments),
}));
exports.stationsRelations = (0, drizzle_orm_1.relations)(exports.chargingStations, ({ many, one }) => ({
    queues: many(exports.queues),
    sessions: many(exports.chargingSessions),
    payments: many(exports.payments),
    owner: one(exports.stationOwners, {
        fields: [exports.chargingStations.ownerWhatsappId],
        references: [exports.stationOwners.whatsappId],
    }),
}));
exports.queuesRelations = (0, drizzle_orm_1.relations)(exports.queues, ({ one, many }) => ({
    station: one(exports.chargingStations, {
        fields: [exports.queues.stationId],
        references: [exports.chargingStations.id],
    }),
    user: one(exports.users, {
        fields: [exports.queues.userWhatsapp],
        references: [exports.users.whatsappId],
    }),
    sessions: many(exports.chargingSessions),
}));
exports.sessionsRelations = (0, drizzle_orm_1.relations)(exports.chargingSessions, ({ one }) => ({
    station: one(exports.chargingStations, {
        fields: [exports.chargingSessions.stationId],
        references: [exports.chargingStations.id],
    }),
    user: one(exports.users, {
        fields: [exports.chargingSessions.userWhatsapp],
        references: [exports.users.whatsappId],
    }),
    queue: one(exports.queues, {
        fields: [exports.chargingSessions.queueId],
        references: [exports.queues.id],
    }),
    payment: one(exports.payments, {
        fields: [exports.chargingSessions.sessionId],
        references: [exports.payments.sessionId],
    }),
}));
exports.ownersRelations = (0, drizzle_orm_1.relations)(exports.stationOwners, ({ many }) => ({
    stations: many(exports.chargingStations),
}));
exports.paymentsRelations = (0, drizzle_orm_1.relations)(exports.payments, ({ one }) => ({
    session: one(exports.chargingSessions, {
        fields: [exports.payments.sessionId],
        references: [exports.chargingSessions.sessionId],
    }),
    user: one(exports.users, {
        fields: [exports.payments.userWhatsapp],
        references: [exports.users.whatsappId],
    }),
    station: one(exports.chargingStations, {
        fields: [exports.payments.stationId],
        references: [exports.chargingStations.id],
    }),
}));
exports.notificationsRelations = (0, drizzle_orm_1.relations)(exports.notifications, ({ one }) => ({
    user: one(exports.users, {
        fields: [exports.notifications.userId],
        references: [exports.users.whatsappId],
    }),
}));
//# sourceMappingURL=schema.js.map